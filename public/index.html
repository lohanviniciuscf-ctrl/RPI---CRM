<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM Premium - Planilha</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a192f;
  --card:#112240;
  --accent:#64ffda;
  --text:#e6f1ff;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,var(--bg),#020c1b);
  color:var(--text);transition:.4s;
}
button,input{padding:10px;border:none;border-radius:10px;font-family:'Poppins';}
button{cursor:pointer;font-weight:600;transition:.3s;}
button:hover{transform:scale(1.05)}
.center{min-height:100vh;display:flex;align-items:center;justify-content:center;}
.box{background:var(--card);padding:35px;border-radius:22px;width:380px;text-align:center;box-shadow:0 25px 60px rgba(0,0,0,.45);animation:fade .5s;}
@keyframes fade{from{opacity:0;transform:translateY(20px)}to{opacity:1}}
.hidden{display:none}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;}
.metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:25px;}
.metric{background:var(--card);padding:20px;border-radius:20px;text-align:center;box-shadow:0 15px 35px rgba(0,0,0,.25);transition:.3s;}
.metric:hover{transform:translateY(-6px)}
.metric strong{font-size:22px}
</style>
</head>
<body>

<div id="envSelect" class="center">
  <div class="box">
    <h2>ğŸŒ Escolha o ambiente</h2><br>
    <button style="background:#e7c09b" onclick="selectEnv('Modelle')">ğŸ‘©â€ğŸ¦° Modelle Skin</button><br><br>
    <button style="background:#64ffda" onclick="selectEnv('Cia')">ğŸ“’ Cia & Arte</button><br><br>
    <button style="background:#7dd3fc" onclick="selectEnv('Thalles')">ğŸŒ¬ï¸ Thalles ClimatizaÃ§Ã£o</button>
  </div>
</div>

<div id="app" class="hidden" style="padding:30px">
<header>
  <h2 id="appTitle"></h2>
  <button onclick="refresh()">ğŸ”„ Atualizar</button>
</header>
<div id="metrics" class="metrics"></div>
<div id="lista"></div>
</div>

<script>
let env=null;
let pedidos=[];

const SHEETS_URL="COLE_AQUI_O_URL_DO_SEU_WEB_APP"; // URL do Apps Script Web

function selectEnv(e){
  env=e;
  document.getElementById("envSelect").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  document.getElementById("appTitle").innerText =
    e==="Modelle" ? "ğŸ‘©â€ğŸ¦° Modelle Skin" :
    e==="Cia" ? "ğŸ“’ Cia & Arte" :
    "ğŸŒ¬ï¸ Thalles ClimatizaÃ§Ã£o";
  loadPedidos();
}

async function loadPedidos(){
  try{
    const r = await fetch(`${SHEETS_URL}?env=${env}`);
    pedidos = await r.json();
    render();
  }catch(e){console.error("Erro ao carregar pedidos:",e);}
}

function render(){
  let total=0,custos=0;
  pedidos.forEach(p=>{total+=p.valor;if(env!=="Modelle") custos+=(p.custo+p.ordinario||0)});
  let lucro=total-custos;
  let comissao=total*0.01;

  document.getElementById("metrics").innerHTML=env==="Modelle"?`
    <div class="metric">Pedidos<br><strong>${pedidos.length}</strong></div>
    <div class="metric">Total<br><strong>R$ ${total.toFixed(2)}</strong></div>
    <div class="metric">ComissÃ£o 1%<br><strong>R$ ${comissao.toFixed(2)}</strong></div>
  `:`
    <div class="metric">Pedidos<br><strong>${pedidos.length}</strong></div>
    <div class="metric">Faturamento<br><strong>R$ ${total.toFixed(2)}</strong></div>
    <div class="metric">Custos<br><strong>R$ ${custos.toFixed(2)}</strong></div>
    <div class="metric">Lucro<br><strong>R$ ${lucro.toFixed(2)}</strong></div>
  `;

  let listaHTML="";
  pedidos.forEach(p=>{
    listaHTML+=`
      <div style="background:#fff;color:#000;padding:15px;margin-bottom:10px;border-radius:10px;">
        <strong>${p.desc}</strong><br>
        ğŸ’° Valor: R$ ${p.valor}<br>
        ${env!=="Modelle"?`ğŸ“‰ Custos: R$ ${p.custo || 0}<br>ğŸ“ˆ Lucro: R$ ${p.lucro || (p.valor-(p.custo||0))}<br>`:""}
        <small>ğŸ“… ${new Date(p.data).toLocaleDateString()}</small>
      </div>
    `;
  });
  document.getElementById("lista").innerHTML = listaHTML;
}

// BotÃ£o de atualizar manual
function refresh(){loadPedidos();}
</script>
</body>
</html>
